/*1325569070,169775557*/

if (window.CavalryLogger) { CavalryLogger.start_js(["rJD1l"]); }

function CIWebmailBootloader(a,b){this.controllerFn=b;var c=Event.listen(a,'mouseover',function(){c.remove();this.bootload();}.bind(this));return this;}copy_properties(CIWebmailBootloader.prototype,{bootload:function(a){Bootloader.loadComponents('contact-importer-webmail',function(){this.controller=this.controller||this.controllerFn();if(a)this.controller.onSubmit();}.bind(this));},onSubmit:function(){if(this.controller){this.controller.onSubmit();}else this.bootload(true);}});
function mobile_activation_show_carriers(){var b=$('selected_country').value;var a=$('carrier_country').value;if(b)hide($(b+'_carrier_select'));$('selected_country').value=a;$('selected_carrier').value=0;show($(a+'_carrier_select'));}function mobile_activation_update_carrier(){var a=$('selected_country').value+'_carrier_select';$('selected_carrier').value=$(a).value;}function MobileSmsActivationController(b,e,c,a,d,f){copy_properties(this,{profile_id:b,parent:parent,source:e,misc:c,carrier:null,AJAX_URI:'/ajax/mobile/activation.php',redirect_uri:null,cb_obj:a,status_id:f||'mobile_throbber'});if(d){this.goVerification();}else this.start();MobileSmsActivationController.instance=this;}MobileSmsActivationController.instance={};MobileSmsActivationController.getInstance=function(){return MobileSmsActivationController.instance;};copy_properties(MobileSmsActivationController.prototype,{goStep:function(a){if(a==2){this.getShortCode();return;}else if(a==3){this.getConfirmCode();return;}this.start();},start:function(a){new AsyncRequest().setURI(this.AJAX_URI).setData({profile_id:this.profile_id,get_carriers:1,source:this.source,misc:this.misc,error:a}).setHandler(this.showCarriers.bind(this)).setStatusElement($(this.status_id)).send();},showCarriers:function(a){var b=a.getPayload();if(this.cb_obj&&this.cb_obj.onShowCarriers){this.cb_obj.onShowCarriers(b);}else new Dialog().setTitle(b.title).setBody(b.html).setHandler(this.getShortCode.bind(this)).setButtons([Dialog.NEXT,Dialog.CANCEL]).show();},getShortCode:function(){if(!this.carrier){this.carrier=parseInt($('selected_carrier').value);if(!this.carrier){this.start(true);return false;}}Dialog.getCurrent()&&Dialog.getCurrent().setButtonsMessage('<img src="/images/loaders/indicator_blue_small.gif" />');new AsyncRequest().setURI(this.AJAX_URI).setData({profile_id:this.profile_id,get_code:1,carrier:this.carrier,source:this.source,misc:this.misc}).setHandler(this.showShortCode.bind(this)).send();return false;},showShortCode:function(a){var b=a.getPayload();if(this.cb_obj&&this.cb_obj.onShowShortCode){this.cb_obj.onShowShortCode(b);}else new Dialog().setTitle(b.title).setBody(b.html).setHandler(this.activate.bind(this)).setButtons([Dialog.NEXT,Dialog.CANCEL]).show();},activate:function(){var a=$('sms_code').value;if(!a)return;var c=ge('profile_add');c=c?c.checked:null;var b=ge('message_on');b=b?b.checked:null;new AsyncRequest().setURI(this.AJAX_URI).setData({profile_id:this.profile_id,confirm:1,code:a,profile_add:c,message_on:b,source:this.source,misc:this.misc}).setHandler(this.confirmCode.bind(this)).setErrorHandler(this.confirmCode.bind(this)).send();},confirmCode:function(a){var b=a.getPayload();if(!a.error&&b.success){if(this.cb_obj&&this.cb_obj.onActivationSuccess){this.cb_obj.onActivationSuccess(b);}else{if(b.redirect_now){goURI(b.redirect);return;}if(b.redirect==null)return;this.redirect_uri=b.redirect;new Dialog().setTitle(b.title).setBody(b.html).setHandler(this.redirect.bind(this)).setButtons([Dialog.OK]).show();}}else if(this.cb_obj&&this.cb_obj.onActivationFailure){this.cb_obj.onActivationFailure(a);}else AsyncResponse.defaultErrorHandler.call(this,a);},redirect:function(){if(this.redirect_uri=='reload'){window.location.reload();}else goURI(this.redirect_uri);},goVerification:function(){new AsyncRequest().setURI(this.AJAX_URI).setData({profile_id:this.profile_id,show_verification:1,source:this.source,misc:this.misc}).setHandler(this.displayVerification.bind(this)).send();return false;},displayVerification:function(a){var b=a.getPayload();if(this.cb_obj&&this.cb_obj.onDisplayVerification){this.cb_obj.onDisplayVerification(b);}else new Dialog().setTitle(b.title).setBody(b.html).setHandler(this.completeVerification.bind(this,a)).setButtons([Dialog.OK]).show();},completeVerification:function(a){var b=a.getPayload();if(this.cb_obj)this.cb_obj.onVerificationComplete(b);}});
function AccountMirrorSmsActivationHandler(){}AccountMirrorSmsActivationHandler.onActivationSuccess=function(){var a={src:AccountMirrorSmsActivationHandler.mirrorSource};new AsyncRequest().setURI('/ajax/account_mirror/refresh.php').setData(a).send();};AccountMirrorSmsActivationHandler.onVerificationComplete=function(){AccountMirrorSmsActivationHandler.onActivationSuccess();};
function update_activation_toolkit_for_friend_suggester(b,a){if(b&&a){var c=a.getUserData();if(c.new_user_score)update_activation_toolkit_ui(c.new_user_score,'profile_action_suggest_friends');}}function update_activation_toolkit_ui(c,a){var b=ge(a);if(b)CSS.addClass(b,'completed');b=ge('needy_progress_bar_progress');if(b)CSS.setStyle(b,'width',c+'px');}
FriendSuggesterDialog={_dialog:null,_close_handler:null,_cancel_handler:null,_newcomer:null,show:function(e,f,d,c,b){this._close_handler=c||bagofholding;this._cancel_handler=b||bagofholding;d=d||false;this._newcomer=e;var a=new AsyncRequest().setURI('/ajax/friend_suggester.php').setData({newcomer:e,friend_added:d,ref:f}).setContextData('clicktype','Suggest a Friend',f==="profile_others");this._dialog=new Dialog().setAsync(a).setCancelHandler(this._cancel_handler).show();},cancelMultiselect:function(){this._dialog.hide();this._close_handler(false,null);},submitMultiselect:function(){var b=Form.serialize($('friend_suggester_popup_form'));if(!b['ids']){try{fs.notice_show("You have not selected any friends. Select friends by clicking on their pictures.",true);}catch(d){this.cancelMultiselect();}return false;}b.suggest=1;this._dialog.hide();var a=new AsyncRequest().setURI('/ajax/friend_suggester.php').setData(b);var c=new Dialog().setAsync(a);c.setCloseHandler(this._close_handler.bind(null,true,c));c.show();}};
var MegaphoneHelper={hideStory:function(g,f,e,b,a){var c={mp_id:g,location:f,context:b};new AsyncRequest().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(c).setHandler(function(h){a&&a(h);}).send();var d=ge(e);if(d)animation(d).to('height',0).duration(500).hide().go();},createModalStory:function(e,f,d,b){var c;if(!e.buttons||!e.buttons.length){e.buttons=Dialog.CLOSE;c=this.hideStory.bind(this,f,d,b,null);}var a=new Dialog(e);if(c)a.setHandler(c);a.show();},buttonOnClick:function(g,f,c,e,b,d){var a=function(){if(b){new AsyncRequest().setURI(e).send();}else document.location.href=e;};if(d){this.hideStory(g,f,'',c,function(){a();});}else a();}};
var MobileHub={sms_link:function(b,f,d,c,e){var a=new AsyncRequest().setMethod('POST').setData({sms_link_cell:b,type:f,profile_id:d,enc_id:c,src:e});if(f=='install_via_sms'){a.setURI('/ajax/mobile/sms_link/');}else a.setURI('/ajax/mobile/sms_link.php');new Dialog().setAsync(a).show();return false;},mms_email_splash:function(c,b){var a=new AsyncRequest().setMethod('POST').setURI('/ajax/mobile/mms_email.php').setData({state:c,profile_id:b});new Dialog().setAsync(a).show();return false;}};
function Photocrop(b,a){this.photo=b;copy_properties(this,copy_properties({target:this.photo.parentNode,width:200,height:200,min_width:100,min_height:100,center_x:(this.photo.offsetWidth||200)/2,center_y:(this.photo.offsetHeight||200)/2},a));var c=this.center_x-this.width/2;var d=this.center_y-this.height/2;this.box=[d,c+this.width,d+this.height,c];CSS.addClass(this.target,'photocrop');['bg','wrapper','viewport'].each(function(e){this[e]=$N('div');CSS.addClass(this[e],e);}.bind(this));this.highlight=$N('img',{src:b.src});CSS.addClass(this.highlight,'highlight');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].each(function(e){var f=$N('div');CSS.addClass(f,e);this.viewport.appendChild(f);}.bind(this));Event.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:Event.kill,selectstart:Event.kill,click:Event.stop});Event.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});[this.bg,this.wrapper].each(function(e){e.style.width=b.offsetWidth+'px';e.style.height=b.offsetHeight+'px';e.style.top=b.offsetTop+'px';e.style.left=b.offsetLeft+'px';});this.redraw();}Photocrop.prototype.redraw=function(){this.highlight.style.clip="rect("+this.box.join("px ")+"px)";this.viewport.style.top=this.box[0]+"px";this.viewport.style.left=this.box[3]+"px";this.viewport.style.height=(this.box[2]-this.box[0])+"px";this.viewport.style.width=(this.box[1]-this.box[3])+"px";};Photocrop.prototype.done=function(){[this.bg,this.wrapper].each(DOM.remove);CSS.removeClass(this.target,'photocrop');var a=this.box.map(Math.round);return {x:Math.max(a[3],0),y:Math.max(a[0],0),width:a[1]-Math.max(a[3],0),height:a[2]-Math.max(a[0],0)};};Photocrop.prototype.mousedown=function(a){this.mouseTarget=a.getTarget();this.pos=Vector2.getEventPosition(a);CSS.addClass(document.body,'draggingMode');return false;};Photocrop.prototype.mousemove=function(d){if(!this.mouseTarget)return;var c=Vector2.getEventPosition(d).sub(this.pos);function b(j,k,i){return Math.max(j,Math.min(i,k));}var a=this.box,g=this.min_width,f=this.min_height;var h=this.wrapper.offsetWidth,e=this.wrapper.offsetHeight;if(this.mouseTarget==this.viewport){c.x=b(-a[3],c.x,h-a[1]);c.y=b(-a[0],c.y,e-a[2]);a[0]+=c.y;a[1]+=c.x;a[2]+=c.y;a[3]+=c.x;}else if(CSS.hasClass(this.mouseTarget,'ne')){a[1]+=c.x=b(a[3]+g-a[1],c.x,h-a[1]);a[0]+=c.y=b(-a[0],c.y,a[2]-f-a[0]);}else if(CSS.hasClass(this.mouseTarget,'nw')){a[3]+=c.x=b(-a[3],c.x,a[1]-g-a[3]);a[0]+=c.y=b(-a[0],c.y,a[2]-f-a[0]);}else if(CSS.hasClass(this.mouseTarget,'se')){a[1]+=c.x=b(a[3]+g-a[1],c.x,h-a[1]);a[2]+=c.y=b(a[0]+f-a[2],c.y,e-a[2]);}else if(CSS.hasClass(this.mouseTarget,'sw')){a[3]+=c.x=b(-a[3],c.x,a[1]-g-a[3]);a[2]+=c.y=b(a[0]+f-a[2],c.y,e-a[2]);}this.redraw();this.pos=this.pos.add(c);return false;};Photocrop.prototype.mouseup=function(a){this.mouseTarget=null;CSS.removeClass(document.body,'draggingMode');};
var PlacesSuggestInfoHeader={clickSuggestEditLink:function(){var b=DOM.scry(document,'#suggest_edit_link');if(b.length>0){var a=document.createEvent('MouseEvents');a.initMouseEvent('click',true,true,window,0,0,0,0,0,false,false,false,false,0,null);b[0].dispatchEvent(a);}return false;}};
var share_last_comment={p:null,t:null};function share_internal_config(a){if(share_last_comment.p==a){a+='&c='+encodeURIComponent(share_last_comment.t?share_last_comment.t:'');}else share_last_comment.p=a;Bootloader.loadComponents(['async','dialog'],function(){var b=new AsyncRequest().setURI('/ajax/sharer/?'+a).setMethod('GET').setReadOnly(true);var c=new Dialog().setAsync(b).setStackable(true).show();});return false;}
function VideoHistogram(){this.videos={};this.video_payloads={};this.listening=false;this.checking=false;}VideoHistogram.prototype.start=function(b){var a=document[b]||window[b];this.videos[b]=a;this.listening=true;};VideoHistogram.prototype.videoFinished=function(d,c){this.videos[d]=null;this.setPayload(d,c);this.updateServer();if(Dialog){var b=Dialog.getCurrent();if(b){var a=b.getButtonElement('collect-credits');a&&Button.setEnabled(a,true);}}};VideoHistogram.prototype.setPayload=function(b,a){this.video_payloads[b]=a;};VideoHistogram.prototype.updateServer=function(){var a=[];for(var c in this.video_payloads){var d=this.video_payloads[c];this.video_payloads[c]=null;if(d)a.push(d);}var b=JSON.stringify(a);new AsyncSignal('/video/motion_log.php',{h:b}).send();this.listening=false;this.checking=false;};VideoHistogram.prototype.checkStatus=function(){if(this.listening){this.checking=true;for(var a in this.videos)if(this.videos[a].reportTime)this.videos[a].reportTime();this.updateServer();}};copy_properties(VideoHistogram,{init:function(){if(!window.video_histogram)window.video_histogram=new VideoHistogram();onbeforeunloadRegister(function(){if(!window.video_histogram.checking)window.video_histogram.checkStatus();});}});
var VideoPermalinkTagger={show:function(){CSS.removeClass($('tagger'),'tagger_inactive');$('tagger_input').focus();},hide:function(){CSS.addClass($('tagger'),'tagger_inactive');},setDataSource:function(a){VideoPermalinkTagger._datasource=a;},setExcluded:function(d,b){var a=VideoPermalinkTagger._datasource;var c=a.getExclusions();d=parseInt(d,10);if(b===false){c.remove(d);}else if(!c.contains(d))c.push(d);a.setExclusions(c);}};function motion_rotate_video(b,a){new AsyncRequest().setURI('/ajax/motion.php').setData({v:b,rotate:a}).setFinallyHandler(function(c){$('rotate_wait').style.display='none';$('rotate_links').style.display='';}).send();$('rotate_links').style.display='none';$('rotate_wait').style.display='';}